---
import PageLayout from '@layouts/PageLayout.astro';
import HeroSimple from '@components/sections/HeroSimple.astro';
import ServiceCard from '@components/ui/ServiceCard.astro';
import Button from '@components/ui/Button.astro';
import CTABanner from '@components/sections/CTABanner.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const services = await getCollection('services');
  return services.map((service) => ({
    params: { slug: service.data.slug },
    props: { service },
  }));
}

const { service } = Astro.props;
const { data } = service;

const allServices = await getCollection('services');
const relatedServices = allServices.filter((s) =>
  data.relatedServices.includes(s.data.slug),
);
---

<PageLayout title={data.metaTitle} description={data.metaDescription}>
  <HeroSimple
    title={data.title}
    description={data.excerpt}
    breadcrumbs={[
      { label: 'Tjänster', href: '/tjanster' },
      { label: data.shortTitle },
    ]}
  />

  <!-- Introduction -->
  <section class="section">
    <div class="container">
      <div class="max-w-3xl" data-reveal>
        {data.introduction.split('\n\n').map((paragraph: string) => (
          <p class="text-lg leading-relaxed text-slate mb-6">{paragraph}</p>
        ))}
      </div>
    </div>
  </section>

  <!-- Benefits -->
  <section class="section-sm bg-surface">
    <div class="container">
      <h2 class="mb-10" data-reveal>Fördelar</h2>
      <div class="grid md:grid-cols-3 gap-8">
        {data.benefits.map((benefit: any, i: number) => (
          <div class="bg-white rounded-xl p-6 border border-border" data-reveal data-delay={String(i + 1)}>
            <div class="w-10 h-10 flex items-center justify-center rounded-lg bg-accent/15 text-accent-dark mb-4">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-navy mb-2">{benefit.title}</h3>
            <p class="text-sm text-gray leading-relaxed">{benefit.description}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Process -->
  <section class="section">
    <div class="container">
      <h2 class="mb-10" data-reveal>Vår process</h2>
      <div class="max-w-3xl">
        {data.process.map((step: any) => (
          <div class="flex gap-6 mb-8" data-reveal>
            <div class="shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-navy text-white font-bold text-lg">
              {step.step}
            </div>
            <div class="pt-1">
              <h3 class="text-lg font-semibold text-navy mb-1">{step.title}</h3>
              <p class="text-gray">{step.description}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Deliverables -->
  <section class="section-sm bg-surface">
    <div class="container">
      <div class="max-w-3xl">
        <h2 class="mb-8" data-reveal>Leverabler</h2>
        <ul class="space-y-3" data-reveal>
          {data.deliverables.map((item: string) => (
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-teal shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.5 12.75l6 6 9-13.5" />
              </svg>
              <span class="text-slate">{item}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <!-- Related Services -->
  {relatedServices.length > 0 && (
    <section class="section">
      <div class="container">
        <h2 class="mb-10" data-reveal>Relaterade tjänster</h2>
        <div class="grid md:grid-cols-3 gap-6">
          {relatedServices.map((s, i) => (
            <div data-reveal data-delay={String(i + 1)}>
              <ServiceCard
                title={s.data.title}
                description={s.data.excerpt}
                href={`/tjanster/${s.data.slug}`}
              />
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <CTABanner
    title={data.ctaText || 'Redo att komma igång?'}
    description="Kontakta oss för att diskutera hur vi kan hjälpa er organisation."
  />
</PageLayout>
